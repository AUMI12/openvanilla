== Journal
* [Kanru Chen 的筆記 (kanru++) http://kanru.info/~kanru/blog/archives/cat_programming.html]

== Plan（劃上刪除線的表示已完成）
* 為了能吸收 skkime 的經驗，總有一天得想辦法從 DDK 下手。懶人總是希望能用 IDE 來開發，所以大概需要研究一下：
** http://b6s.blogspot.com/2005/09/ddk-ide.html
* -替 !OVModule 寫 .def 檔案，以免還需要改程式碼。需要寫進 .def 裡的就是那些開頭有 extern "C" 的函式。-
* -以 explicit link 方式使用 !OVModule 的 !DLLs，也就是使用 !LoadLibrary/!GetProcAddress/!FreeLibrary，相當於 dlopen/dlsym/dlclose。-
** -用 libtool (lt_dlopen/lt_dlsym/lt_close) 實作了。-
* 建議參考 [realfun 釋出的雙通輸入法源碼 http://www.cnblogs.com/realfun/archive/2005/06/26/181302.html]，C++ 的成分比較高。
* -UI 的部分盡量也抽離為 DLL，不要跟 win32 IME API 的部分混在一起（也許跟 gugod 在[通信論壇 http://rt.openfoundry.org/Foundry/Project/Forum/List.html/wws/arc/openvanilla-developer/2005-07/msg00007.html]上講到「其實此函式庫本身也是一個 loader ， 但就是不處理 UI 部份的事情的純 loader」是類似的）。-
** !OpenVanilla.h 所定義之 API 的函式庫化還要再研究。

== Nightly Builds
* 聲明
** 請詳閱下面的 Known Issues 和 Installing Instructions
** 這是仍在開發初期的版本，請不要拿來做正事，以免應用程式意外中止時造成您的損失。
** 歡迎到 !FreeNode 的 #im-dev 參與開發工作的討論。
* [20050913 http://openvanilla.org/plugin/attachments/Win32Issues/OpenVanilla-Win32-20050913.exe]
** 本日安裝檔只有 base 和 !OVIMRoman，其他模組需另外[下載 http://openvanilla.org/plugin/attachments/Win32Issues/OpenVanilla-Win32-Modules.exe]安裝。
** 如果不想重新下載安裝模組，請把 %WINDIR%\OpenVanilla\Modules 備分好之後再反安裝舊的 OV。
** [#13702 http://rt.openfoundry.org/Foundry/Project/Tracker/Display.html?id=13702&Queue=209] 修復選字視窗亂跑或是被遮住的問題。
* [20050912 http://openvanilla.org/plugin/attachments/Win32Issues/OpenVanilla-Win32-0.7.1rc0+r1482.exe]
** OVOutputFilter 支援。暫時利用 !OVPref 裡面的模組設定來決定順序與啟用。
** Installer 會偵測舊版的存在(0.7.1rc0)。
** [#13392 http://rt.openfoundry.org/Foundry/Project/Tracker/Display.html?Queue=209&id=13392]: config.xml 移動到 !UserDir，!UserDir 移動到 Documents and Settings\%USER%\Application Data ，如此一來在多使用者環境可以有各自的設定。
** [#13401 http://rt.openfoundry.org/Foundry/Project/Tracker/Display.html?Queue=209&id=13401]
** [#13406 http://rt.openfoundry.org/Foundry/Project/Tracker/Display.html?Queue=209&id=13406]
** [#13496 http://rt.openfoundry.org/Foundry/Project/Tracker/Display.html?Queue=209&id=13496]
* 20050902: [OpenVanilla-Win32-0.7.1rc0 http://openvanilla.org/plugin/attachments/Win32Issues/OpenVanilla-Win32-0.7.1rc0.exe]
** 解決 Known Issue 4, 5。
** 安裝過後會自動出現在輸入列，不用手動新增。
** 修正了 Status 視窗位置固定的問題。
** 修正了在 mozilla 中無法移動游標的問題。
** 安裝包中新增三個模組。
** 新增可用的設定介面 !OVPreferences。
** Status 視窗上的中英切換可以使用，或是用 !CapsLock 切換。
* [20050818 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050818.exe]
** !PCMan 修正了 UI 與版本低於 XP 之 Windows 平台不相容的問題。([Screenshot http://www.flickr.com/photos/b6s/35088089/])
** kanru 用 NSIS 做好了最基本的[安裝程式 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050818.exe]!
** 改變目錄結構，劃分出 Modules 和 User 區，之前 Nightly Build 的使用者請照 Uninstalling Instructions 移除後重新安裝。
* [20050817 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050817.zip]
** 以 /MT 全部重新編譯，解決 Known Issue 12，避免使用者缺少 !MSVCR7x.dll 的問題。
** 輸入法模組系列 (OVIM*.zip) 也全部更新，請重新下載安裝。
** 本版 zip 檔內缺少 libexpat.dll，請以其他 zip 檔裡的代替。
* [20050811 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050811.zip]
** kanru 修好了一個與 shift 鍵相關的問題，該問題會影響到 OVIMPOJ-Holo 使用方式。
** (這版好像怪怪的，我個人安裝此版OV會爛掉，建議裝前面一版。Pektiong)
* [20050809 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050809-K.zip]
** 修好介面的問題，現在可以和 Mozilla 一起使用！
* [20050808 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-2005080824-K.zip]
** 換上新圖示。
** 可配合新的 module !OVIMTibetan 使用。
* [20050807 http://kanru.info/~kanru/kwiki/plugin/attachments/IMEReference/OV-Win32-2005080706-K.zip]
** [Modules http://kanru.info/~kanru/kwiki/plugin/attachments/IMEReference/OV-Win32-Mod-2005080706-K.zip] 模組更新頻率較低，從 Nightly Builds 中分離。
** kanru 加入了以 SCEW 實作的 !OVDictionary 介面，現在可以存取設定檔了！
* 20050806
** 改用 !PCMan 寫的 GUI，!PCMan++！
* [20050805 http://kanru.info/~kanru/kwiki/plugin/attachments/IMEReference/OV-Win32-20050805-K.zip]
* [20050804 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050804.zip]
** 解決 Known Issues 3, 6, 7, 8.1, 9。
** 改以 DLL 形式使用 !SQLite3。
* [200508032230 http://kanru.info/~kanru/kwiki/plugin/attachments/IMEReference/OVWin32.zip]
** 內含 !OVIMChewing！
** 加入 libiconv-2.dll。
* [200508030525 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-200508030525.zip]
** 新增 !OVIMTobacco 模組，目前僅支援自動選字注音。可用「爺爺您終於回來啦」測試，但請注意有注音符號無法顯示的問題。
* [20050802 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050802.zip]

== Known Issues（劃上刪除線的表示已完成）
=== 即日起 (20050902) 正式改由 http://openvanilla.openfoundry.org/ 來管理，此區將不再更新。
0 -現在只有第一組輸入法會生效，舉例來說，如果同時有 !OVIMGenericSQLite 和 !OVIMHolo-POJ，只有前者能用。想測某模組時就把其他的模組砍掉吧！-
0 !OVIMGenericSQLite 的 imtables.db 裡目前只能有一組輸入法，否則會當掉。
0 -還沒有狀態列的介面。-
00 -狀態列還沒有切換輸入法等功能。-
0 -還有許多鍵盤事件尚未處理，例如上下左右和 PgUp/PgDn。-
0 -在應用程式上第一次想用 CTRL+Space 切掉輸入法回到英文模式時，可能得按兩次。-
0 -在組字列裡可能還會有一點編碼問題（字根輸入到一半按個 !BackSpace 就知道了）。-
0 -在 !WordPad 及 !EmEditor 中 !BackSpace 行為不正常，但在 !NotePad 和 Word 裡沒問題。-
00 -送出來的字後面好像會跟著神祕的 CTRL+H.-
000 -在用 irssi 的時候還會有 CTRL+P/N 的「效果」...orz-
0 -載入模組後要分辨 OVInputMethod 和 OVOutputFilter 的不同，只有前者才可以進行 newContext()-。
00 -暫時以 try-catch 來跳過 OVOutputFilter。-
00 -原來有 OVModule::moduleType() 可以用，已解決。-
0 -第一次使用 !OVInputMethodContext::keyEvent() 前應該呼叫 !OVInputMethodContext::start()。-
0 結束前應該呼叫 !OVInputMethodContext::end()。
0 !OVIMTobacco 內部流程有 bug，會使 key sequence（注音符號）更新狀態不正常。
0 -安裝包裡頭似乎少包了 !MSVCR7x.dll 之類的 library，在 XP 上需要另外找這些 dll 才能裝。-
00 -暫時只在 Installing Instructions 中提示此問題。-
0 -在 Firefox 與 Thunderbird 等應用程式中，會進入到 inline-input，這種狀況下會無法帶出選字視窗。-
0 在某些狀況下會亂掉，如下圖
http://flickr.com/photo_zoom.gne?id=32466548&size=o

== Installing Instructions
* 20050818 以後開始提供 installer。
* 抓最新的 Nightly Build 下來解壓縮，按照以下說明進行：
** 若您使用的是 20050817 「之前」的版本，而 %WINDIR%\system32 中沒有 !MSVCR7x.dll，請 Google、下載並安裝之。請參閱 http://msdn.microsoft.com/library/cht/default.asp?url=/library/CHT/vccore/html/vcoriRedistributingMFCATLOLEDBTemplatesApplications.asp。
** %WINDIR%\system32 裡要有 OVIME.ime, OVIMEUI.dll 及 libltdl3.dll。
*** [200508032230 http://kanru.info/~kanru/kwiki/plugin/attachments/IMEReference/OVWin32.zip] 以後的版本，%WINDIR%\system32 裡還要有 libiconv-2.dll。
*** [20050804 http://openvanilla.org/plugin/attachments/Win32Issues/OV-Win32-20050804.zip] 以後的版本，%WINDIR%\system32 裡還要有 sqlite3.dll。
*** 20050807 以後的版本，%WINDIR%\system32 裡還要有 libexpat.dll。
*** %WINDIR% 可能是 Windows 或 WINNT，不一定在 C:。
** -%WINDIR%\!OpenVanilla- (20050818 以後路徑改變) %WINDIR%\!OpenVanilla\Modules 裡要有輸入法模組的 dll 及該模組的同名目錄，例如 !OVIMGeneric.dll。
*** 同名目錄（以上例來說是 -%WINDIR%\!OpenVanilla\!OVIMGeneric- %WINDIR%\!OpenVanilla\Modules\!OVIMGeneric）裡可能會有 .cin 檔或 .db 檔，例如 cj.cin。
* 執行 [OVIME.reg http://openvanilla.org/plugin/attachments/Win32Issues/OVIME.reg]
** 相關登錄 (Registry) 格式說明
*** 註冊輸入法
 [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts\E0990404]
 "layout text"="中文 (繁體) - OpenVanilla"
 "layout file"="kbdus.dll"
 "IME file"="OVIME.ime"
**** E0990404 裡的 E 代表這是輸入法而不是普通的鍵盤對應（Dvorak 之類的）；099 是序號，照理說應該自動遞增，在此故意設成 099 免得蓋到既有的輸入法；0404 代表 locale 為「中文（台灣）」。
**** 其實還有更多設定，但由於目前實作的程度不到那裡，暫時也用不上。以微軟拼音為例：
 [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts\E00E0804]
 "Layout File"="kbdus.dll"
 "Layout Text"="中文 (簡體) - 微軟拼音輸入法 3.0"
 "Layout Display Name"="@%SystemRoot%\\system32\\input.dll,-5091"
 "IME File"="pintlgnt.ime"
 "System IME File"="C:\\WINDOWS\\system32\\Pintlgnt.ime"
 "Old IME Version"=dword:0503114b
 "Old IME CodePage"=dword:000004b0
***** 0804 代表「中文（PRC）」。
***** Layout Display Name 用來設定 localized name，它會取代 Layout Text，以免在不同語系的 Windows 無法顯示輸入法名稱。
***** System IME File 通常和 IME File 是一樣的，但是看來也可以寫別的路徑。
***** Old IME Version 和 Old IME !CodePage... 嗯，我沒去查 MSDN (orz)，我猜它是在說明這個輸入法的「傳統」模式是什麼，例如「注音」之於「新注音」的關係。
*** 載入輸入法
 [HKEY_CURRENT_USER\Keyboard Layout\Preload]
 "1"="00000404"
 "2"="e0990404"
 "3"="e0010404"
 "4"="e0090404"
**** 這就是新增輸入法之後的狀況，順序可以手動改，但是只要一開啟輸入法設定，系統又會依照輸入法名稱自動重新排序。

== Uninstalling Instructions
* 將 Installing Instructions 全部還原，也就是將檔案移除，並將登錄中的機碼刪去。

== Source Codes
* http://svn.openfoundry.org/openvanilla/trunk/Experiments/Win32 (可能比較新)
* http://opensvn.csie.org/OVIME

== Porting Hints
* 模組程式碼中如果有
 #include <OpenVanilla/foo.h>
這樣的段落，請暫時改成
 #ifndef WIN32
 #include <OpenVanilla/foo.h>
 #else
 #include "foo.h"
 #endif
* STL std::string::clear() 請改為 std::string::erase() (blame MSVC!)
* 某些
 #include <sys/bar>
是 U*IX only 的，請嘗試使用替代方案，例如：
** 為了使用 PATH_MAX 而引入的 <sys/syslimits.h>，可改用 <windows.h> 的 MAX_PATH
 #ifndef WIN32
 #include <sys/syslimits.h>
 #else
 #include <windows.h>
 #define PATH_MAX MAX_PATH
 #endif
** 在 Windows 上與 strcasecmp 效果相同的是 stricmp
 #ifdef WIN32
 #define strcasecmp stricmp
 #endif
** 如果有空把 [LibGw32c http://gnuwin32.sourceforge.net/packages/libgw32c.htm] 弄進來，這部分就不必改用 Win32 API 了。
*** 由於 OVIME.ime 目前只能用 VC++ 的 cl.exe 做，而要與 g++ 做出來的 DLL 連結不是很容易，[LibGw32c http://gnuwin32.sourceforge.net/packages/libgw32c.htm] 大概沒那麼快試出來。
* Makefile 還沒改，請先仿照已 port 模組目錄中 make.bat 的方式編譯 DLL。

== wxWidgets Settings
0 Install [http://prdownloads.sourceforge.net/wxwindows/wxMSW-2.6.2-Setup.exe wxWidgets-2.6.2]
0 Use VS.NET 2003 to open %WXWIN%\build\msw\wx.dsw and let it converts all project files into new format.
0 Build in Debug, Release, and Unicode-Release modes, respectively.
0 Change including path and library path of !OVPreferences.vcproj to your own places if you didn't install !wxWidgets under [=C:\wxWidgets-2.6.2].

== Debugging Instructions
* 建議使用 VS.NET 2003 比較方便，下面的步驟皆以此為準。
** 首先切換到 Debug 模式，再建置方案，見[圖一 http://photos23.flickr.com/30251873_e3fa0fea49_o.png]。
** 將產生出來的 DLL 放到該放的地方。
** 開始偵錯。第一次使用時會要求指定要監控的應用程式，在此以 notepad 為例，見[圖二 http://photos22.flickr.com/30251874_8570482c44_o.png]。
** 接著開啟輸入法，然後就會在輸出視窗看到相關 DLL 的偵錯符號已載入，見[圖三 http://photos22.flickr.com/30251875_050e9ae43e_o.png]。
* 如果不想用 VS.NET 2003，可以考慮只用 [Visual C++ ToolKit 2003 http://msdn.microsoft.com/visualc/vctoolkit2003/]，搭配 !OVUtility.h 裡的 murmur() 或是 Util.h 裡的 !DebugLog macro，以 log 檔形式來偵錯。

== DLL references
* [MSDN Library: DLLs http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore/html/_core_DLL_Topics.asp]
* [Windows下DLL编程技术及应用 http://www.programfan.com/article/showarticle.asp?id=21]
* [创建动态连接库 http://www.impcas.ac.cn/usr/yuanyj/vcpptutorial/chap9_3.htm]
* [VC中DLL的创建及调用方法 http://www.kehui.net/index.php/article/read/31/15833]
* [DLL 介紹 part 1  http://66.102.7.104/search?q=cache:mJsSY61_5lIJ:163.19.19.4/~jack/b_dll_1.htm+loadlibrary+farproc&hl=zh-TW&lr=lang_zh-CN|lang_zh-TW&client=firefox-a]
* [DLL 介紹 part 2 http://66.102.7.104/search?q=cache:l6n6123WxFgJ:163.19.19.4/~jack/b_dll_2.htm+loadlibrary+farproc&hl=zh-TW&lr=lang_zh-CN|lang_zh-TW&client=firefox-a]
* [深入浅出Dll(介绍函数导出、类导出、钓子dll、不同语言混合编程方法、插件等的实现方法) http://www.zahui.com/html/9/20560.htm]
* [Explicitly Linking to Classes in DLL http://www.codeguru.com/Cpp/W-P/dll/importexportissues/article.php/c123/]
** [DLL中类的显式链接 http://www.zj55.net/article/html/s1316/9540.htm]

== Misc
* [不用 IME API 而用 hook 的方法 http://www.yesky.com/288/1874788.shtml]
